<!DOCTYPE html>
<html style="height: 100%;">

<style>
    textarea {
        font-family: Georgia, serif;
        resize: none;
    }
</style>

<body style="height: 100%; margin: 0; padding: 0;">
    <div style="position: relative; width: 100%;">
    <img style="width: 100%; height: 100vh; display: block; position: fixed;" data-for="background-image">

    <div style="
        position: absolute;
        top: 0; left: 0; right: 0;
        margin-left: 30vw;
        margin-right: 30vw;
        padding-top: 0.25vh;
        padding-bottom: 2.5vh;
        border-radius: 1.25%;
        margin-top: 5vh;
        background-color: #EAEAEA;
    ">
        <h2 style="text-align: center; font-family: Georgia, serif; font-weight: lighter;">Add animal</h2>
        <div style="display: flex; flex-direction: column; align-items: center; font-family: Georgia, serif; font-weight: lighter;">
            <div style="display: flex; flex-direction: column; align-items: flex-start; width: max-content;">
                <label id="capacity" style="margin-top: 2.5vh; margin-bottom: 1.25vh;"></label>
                <label style="margin-top: 1.25vh;">Name:</label>
                <input style="width: 30vw; height: 4.5vh; margin-top: 1.25vh;" type="text" placeholder="Max" id="name">
                <label style="margin-top: 1.25vh;">Age and Birthday:</label>
                <input style="width: 30vw; height: 4.5vh; margin-top: 1.25vh;" type="text" placeholder="6 years 9 months, born on: 9/20/2019" id="Age+Birthday">
                <label style="margin-top: 1.25vh;">Sex:</label>
                <select id="sex">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                </select>
                <label style="margin-top: 1.25vh;">Reproductive Organs:</label>
                <select id="RO">
                    <option value="true">True</option>
                    <option value="false">False</option>
                </select>
                <label style="margin-top: 1.25vh;">Animal and Breed:</label>
                <input style="width: 30vw; height: 4.5vh; margin-top: 1.25vh;" type="text" placeholder="Dog, Standard Parti Poodle" id="A+B">
                <label style="margin-top: 1.25vh;">Vaccinations (seperate each one with a comma):</label>
                <input style="width: 30vw; height: 4.5vh; margin-top: 1.25vh;" type="text" placeholder="rabies, tetanus, another vaccine, and another one, etc..." id="vaccinations">
                <label style="margin-top: 1.25vh;">Special Needs:</label>
                <textarea style="margin-top: 1.25vh; width: 30vw; height: 7.5vh;" id="needs" placeholder="Partially deaf in the left ear."></textarea>
                <label style="margin-top: 1.25vh;">Preferences and General Information:</label>
                <textarea style="margin-top: 1.25vh; width: 30vw; height: 7.5vh;" id="preferences" placeholder="Likes being in a house with kids, very social and playful as well as house trained and affectionate."></textarea>
                <label style="margin-top: 1.25vh;">Pictures (seperate each one with a comma):</label>
                <textarea style="margin-top: 1.25vh; width: 30vw; height: 7.5vh;" id="pictures" placeholder="/Max/frisbee.jpeg,/Max/eating.jpg,/Colin/drinking.png"></textarea>
                <label style="margin-top: 1.25vh;">Height/Length and weight:</label>
                <input style="width: 30vw; height: 4.5vh; margin-top: 1.25vh;" type="text" placeholder="32 inches long, 40 lbs" id="H/L+W">
                <label style="margin-top: 1.25vh;">History:</label>
                <textarea style="margin-top: 1.25vh; width: 30vw; height: 7.5vh;" id="history" placeholder="Had a spaying on 3/19/2020"></textarea>
            </div>
            <button onclick="send()" style="padding: 2.5vh; margin-top: 2.5vh; width: 30%; height: 10vh; font-family: Georgia, serif; font-weight: lighter; font-size: 20px;">Add animal</button>
    </div>

    <script>
        const ws = new WebSocket("ws://localhost:8765");

        function send() {
            ws.send(JSON.stringify({
                "instruction": "add animal",
                "sessionID": localStorage.getItem("Nedis232-animal-shelter-sessionID"),
                "name": document.getElementById("name").value,
                "age": document.getElementById("Age+Birthday").value,
                "sex": document.getElementById("sex").value,
                "RO": document.getElementById("RO").value,
                "A+B": document.getElementById("A+B").value,
                "vaccinations": document.getElementById("vaccinations").value,
                "needs": document.getElementById("needs").value,
                "preferences": document.getElementById("preferences").value,
                "hw": document.getElementById("H/L+W"),
                "pictures": document.getElementById("pictures").value,
                "history": document.getElementById("history").value
            }));
        }
    
        ws.onopen = () => {
            ws.send(JSON.stringify({"instruction": "image", "path": "signup.jpeg", "for": "background-image"}));
            setTimeout(ws.send(JSON.stringify({"instruction": "request capacity"})), 1000);
        }
    
        ws.onmessage = (event) => {
            const res = JSON.parse(event.data);

            if (res["server response"] == "image") {
                const elements = document.querySelectorAll(`[data-for="${res["for"]}"]`);
                elements.forEach(el => {
                    el.src = "data:image/png;base64," + res["data"];
                });
            } else if (res["server response"] == "add animal") {
                if (res["success"]) {
                    window.location.href = "addanimal.html";
                } else {
                    alert(cmd["errormsg"]);
                }
            } else if (res["server response"] == "return capacity") {
                document.getElementById("capacity").innerHTML = "Available space: " + res["capacity"];
            }
        };
    </script>
</body>
</html>
